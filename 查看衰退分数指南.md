# æŸ¥çœ‹è¡°é€€åˆ†æ•°å®Œæ•´æŒ‡å— ğŸ“Š

## ğŸ¯ è¡°é€€åˆ†æ•°åœ¨å“ªé‡Œï¼Ÿ

è¡°é€€åˆ†æ•°å­˜å‚¨åœ¨æ•°æ®åº“çš„ `memories` è¡¨ä¸­çš„ `decay_score` å­—æ®µã€‚

---

## ğŸ’¾ åœ¨æ•°æ®åº“ä¸­æŸ¥çœ‹

### æ–¹æ³•1ï¼šä½¿ç”¨ SQLite å‘½ä»¤è¡Œ

```bash
# è¿›å…¥å®¹å™¨
docker compose exec openmemory-api bash

# æ‰“å¼€æ•°æ®åº“
sqlite3 openmemory.db

# æŸ¥çœ‹æ‰€æœ‰è®°å¿†çš„è¡°é€€åˆ†æ•°
SELECT 
    id,
    content,
    decay_score,
    importance_score,
    access_count,
    last_accessed_at,
    created_at
FROM memories 
WHERE state = 'active'
ORDER BY decay_score ASC
LIMIT 20;

# æŸ¥çœ‹è¡°é€€åˆ†æ•°ç»Ÿè®¡
SELECT 
    CASE 
        WHEN decay_score >= 0.7 THEN 'æ–°é²œ (â‰¥0.7)'
        WHEN decay_score >= 0.3 THEN 'ä¸­ç­‰ (0.3-0.7)'
        ELSE 'è¡°é€€ (<0.3)'
    END as decay_level,
    COUNT(*) as count,
    AVG(decay_score) as avg_score
FROM memories 
WHERE state = 'active'
GROUP BY decay_level;

# é€€å‡º
.exit
exit
```

### æ–¹æ³•2ï¼šä½¿ç”¨ MySQL å®¢æˆ·ç«¯ï¼ˆå¦‚æœä½¿ç”¨ MySQLï¼‰

```bash
# è¿›å…¥å®¹å™¨
docker compose exec openmemory-api bash

# è¿æ¥æ•°æ®åº“
mysql -u username -p openmemory

# æŸ¥çœ‹è¡°é€€åˆ†æ•°
SELECT 
    id,
    SUBSTRING(content, 1, 50) as content_preview,
    decay_score,
    importance_score,
    access_count,
    last_accessed_at,
    created_at
FROM memories 
WHERE state = 'active'
ORDER BY decay_score ASC
LIMIT 20;

# é€€å‡º
exit;
exit
```

### æ–¹æ³•3ï¼šä½¿ç”¨æ•°æ®åº“ç®¡ç†å·¥å…·

**æ¨èå·¥å…·ï¼š**
- **DBeaver**ï¼šhttps://dbeaver.io/
- **DB Browser for SQLite**ï¼šhttps://sqlitebrowser.org/
- **phpMyAdmin**ï¼ˆMySQLï¼‰

**è¿æ¥ä¿¡æ¯ï¼š**
```
æ•°æ®åº“ç±»å‹ï¼šSQLite / MySQL
æ•°æ®åº“æ–‡ä»¶ï¼šapi/openmemory.db (SQLite)
ä¸»æœºï¼šlocalhost
ç«¯å£ï¼š3306 (MySQL)
```

---

## ğŸ”Œ é€šè¿‡ API æŸ¥çœ‹

### 1. æŸ¥çœ‹å•ä¸ªè®°å¿†çš„è¡°é€€åˆ†æ•°

**æ¥å£ï¼š** `GET /api/v1/memories/{memory_id}`

```bash
curl "http://localhost:8765/api/v1/memories/abc123"
```

**å½“å‰å“åº”ï¼š**
```json
{
  "id": "abc123",
  "text": "è®°å¿†å†…å®¹",
  "created_at": 1733184000,
  "state": "active",
  "app_id": "app1",
  "app_name": "æµ‹è¯•åº”ç”¨",
  "categories": ["å·¥ä½œ"],
  "metadata_": {}
}
```

**éœ€è¦æ·»åŠ çš„å­—æ®µï¼š**
```json
{
  "id": "abc123",
  "text": "è®°å¿†å†…å®¹",
  "created_at": 1733184000,
  "state": "active",
  "app_id": "app1",
  "app_name": "æµ‹è¯•åº”ç”¨",
  "categories": ["å·¥ä½œ"],
  "metadata_": {},
  
  // æ–°å¢è¡°é€€ç›¸å…³å­—æ®µ
  "decay_score": 0.65,
  "importance_score": 0.5,
  "access_count": 5,
  "last_accessed_at": 1733270400
}
```

### 2. æŸ¥çœ‹è®°å¿†åˆ—è¡¨çš„è¡°é€€åˆ†æ•°

**æ¥å£ï¼š** `GET /api/v1/memories/`

```bash
curl "http://localhost:8765/api/v1/memories/?user_id=user123&page=1&size=10"
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "items": [
    {
      "id": "abc123",
      "content": "è®°å¿†å†…å®¹",
      "decay_score": 0.85,
      "importance_score": 0.7,
      "access_count": 10,
      "created_at": "2025-12-01T10:00:00",
      "categories": ["å·¥ä½œ"]
    }
  ],
  "total": 100,
  "page": 1,
  "size": 10
}
```

### 3. æŸ¥çœ‹è¡°é€€ç»Ÿè®¡

**æ¥å£ï¼š** `GET /api/v1/decay/statistics?user_id=user123`

```bash
curl "http://localhost:8765/api/v1/decay/statistics?user_id=user123"
```

**å“åº”ï¼š**
```json
{
  "success": true,
  "statistics": {
    "total_active_memories": 150,
    "total_archived_memories": 25,
    "average_decay_score": 0.65,
    "high_decay_count": 80,
    "medium_decay_count": 60,
    "low_decay_count": 10
  }
}
```

### 4. æŸ¥çœ‹è¡°é€€ä¸¥é‡çš„è®°å¿†

**æ¥å£ï¼š** `GET /api/v1/decay/decayed-memories`

```bash
curl "http://localhost:8765/api/v1/decay/decayed-memories?user_id=user123&threshold=0.3&limit=50"
```

**å“åº”ï¼š**
```json
{
  "success": true,
  "count": 10,
  "threshold": 0.3,
  "memories": [
    {
      "id": "abc123",
      "content": "è®°å¿†å†…å®¹...",
      "decay_score": 0.25,
      "importance_score": 0.5,
      "access_count": 2,
      "last_accessed_at": "2025-11-01T10:00:00",
      "created_at": "2025-10-01T10:00:00"
    }
  ]
}
```

---

## ğŸŒ åœ¨ Web ç•Œé¢æŸ¥çœ‹

### å½“å‰çŠ¶æ€

ç›®å‰ Web ç•Œé¢ï¼ˆ`http://localhost:3000`ï¼‰**ä¸æ˜¾ç¤º**è¡°é€€åˆ†æ•°ã€‚

### éœ€è¦ä¿®æ”¹çš„å‰ç«¯æ–‡ä»¶

è¦åœ¨ Web ç•Œé¢æ˜¾ç¤ºè¡°é€€åˆ†æ•°ï¼Œéœ€è¦ä¿®æ”¹ä»¥ä¸‹æ–‡ä»¶ï¼š

#### 1. è®°å¿†åˆ—è¡¨ç»„ä»¶

**æ–‡ä»¶ä½ç½®ï¼š** `ui/components/MemoryList.tsx` æˆ–ç±»ä¼¼æ–‡ä»¶

**éœ€è¦æ·»åŠ çš„æ˜¾ç¤ºï¼š**
```tsx
<div className="memory-card">
  <div className="memory-content">{memory.content}</div>
  
  {/* æ–°å¢ï¼šè¡°é€€åˆ†æ•°æ˜¾ç¤º */}
  <div className="memory-meta">
    <span className="decay-score">
      è¡°é€€åˆ†æ•°: {(memory.decay_score * 100).toFixed(0)}%
    </span>
    <span className={`decay-badge ${getDecayLevel(memory.decay_score)}`}>
      {getDecayLabel(memory.decay_score)}
    </span>
  </div>
</div>
```

**è¾…åŠ©å‡½æ•°ï¼š**
```typescript
function getDecayLevel(score: number): string {
  if (score >= 0.7) return 'high';
  if (score >= 0.3) return 'medium';
  return 'low';
}

function getDecayLabel(score: number): string {
  if (score >= 0.7) return 'æ–°é²œ';
  if (score >= 0.3) return 'ä¸­ç­‰';
  return 'è¡°é€€';
}
```

**æ ·å¼ï¼š**
```css
.decay-score {
  font-size: 0.9em;
  color: #666;
}

.decay-badge {
  padding: 2px 8px;
  border-radius: 4px;
  font-size: 0.8em;
  font-weight: bold;
}

.decay-badge.high {
  background-color: #4caf50;
  color: white;
}

.decay-badge.medium {
  background-color: #ff9800;
  color: white;
}

.decay-badge.low {
  background-color: #f44336;
  color: white;
}
```

#### 2. è®°å¿†è¯¦æƒ…é¡µé¢

**æ˜¾ç¤ºå®Œæ•´çš„è¡°é€€ä¿¡æ¯ï¼š**
```tsx
<div className="memory-detail">
  <h2>è®°å¿†è¯¦æƒ…</h2>
  
  <div className="detail-section">
    <h3>è¡°é€€ä¿¡æ¯</h3>
    <div className="decay-info">
      <div className="info-item">
        <label>è¡°é€€åˆ†æ•°ï¼š</label>
        <span className="value">{(memory.decay_score * 100).toFixed(1)}%</span>
        <div className="progress-bar">
          <div 
            className="progress-fill" 
            style={{width: `${memory.decay_score * 100}%`}}
          />
        </div>
      </div>
      
      <div className="info-item">
        <label>é‡è¦æ€§ï¼š</label>
        <span className="value">{(memory.importance_score * 100).toFixed(0)}%</span>
      </div>
      
      <div className="info-item">
        <label>è®¿é—®æ¬¡æ•°ï¼š</label>
        <span className="value">{memory.access_count} æ¬¡</span>
      </div>
      
      <div className="info-item">
        <label>æœ€åè®¿é—®ï¼š</label>
        <span className="value">
          {memory.last_accessed_at 
            ? new Date(memory.last_accessed_at).toLocaleString() 
            : 'ä»æœªè®¿é—®'}
        </span>
      </div>
    </div>
  </div>
</div>
```

#### 3. ç»Ÿè®¡ä»ªè¡¨æ¿

**æ·»åŠ è¡°é€€ç»Ÿè®¡å›¾è¡¨ï¼š**
```tsx
<div className="dashboard">
  <h2>è®°å¿†ç»Ÿè®¡</h2>
  
  <div className="stats-grid">
    <div className="stat-card">
      <h3>å¹³å‡è¡°é€€åˆ†æ•°</h3>
      <div className="stat-value">
        {(stats.average_decay_score * 100).toFixed(1)}%
      </div>
    </div>
    
    <div className="stat-card">
      <h3>è®°å¿†åˆ†å¸ƒ</h3>
      <div className="distribution">
        <div className="dist-item">
          <span className="label">æ–°é²œ</span>
          <span className="count">{stats.high_decay_count}</span>
        </div>
        <div className="dist-item">
          <span className="label">ä¸­ç­‰</span>
          <span className="count">{stats.medium_decay_count}</span>
        </div>
        <div className="dist-item">
          <span className="label">è¡°é€€</span>
          <span className="count">{stats.low_decay_count}</span>
        </div>
      </div>
    </div>
  </div>
</div>
```

---

## ğŸ“Š å¯è§†åŒ–ç¤ºä¾‹

### è¡°é€€åˆ†æ•°è¿›åº¦æ¡

```
æ–°é²œè®°å¿† (0.85):
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘  85%

ä¸­ç­‰è¡°é€€ (0.45):
â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  45%

ä¸¥é‡è¡°é€€ (0.12):
â–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘  12%
```

### è¡°é€€ç­‰çº§å¾½ç« 

```
ğŸŸ¢ æ–°é²œ (â‰¥0.7)
ğŸŸ¡ ä¸­ç­‰ (0.3-0.7)
ğŸ”´ è¡°é€€ (<0.3)
```

---

## ğŸ”§ å¿«é€ŸæŸ¥çœ‹å‘½ä»¤

### æŸ¥çœ‹è¡°é€€åˆ†æ•°æœ€ä½çš„10æ¡è®°å¿†

```bash
docker compose exec openmemory-api sqlite3 openmemory.db \
  "SELECT id, SUBSTR(content, 1, 50), decay_score 
   FROM memories 
   WHERE state='active' 
   ORDER BY decay_score ASC 
   LIMIT 10;"
```

### æŸ¥çœ‹è¡°é€€åˆ†æ•°åˆ†å¸ƒ

```bash
docker compose exec openmemory-api sqlite3 openmemory.db \
  "SELECT 
     CASE 
       WHEN decay_score >= 0.7 THEN 'æ–°é²œ'
       WHEN decay_score >= 0.3 THEN 'ä¸­ç­‰'
       ELSE 'è¡°é€€'
     END as level,
     COUNT(*) as count
   FROM memories 
   WHERE state='active'
   GROUP BY level;"
```

### æŸ¥çœ‹ç‰¹å®šç”¨æˆ·çš„è¡°é€€ç»Ÿè®¡

```bash
curl "http://localhost:8765/api/v1/decay/statistics?user_id=user123" | jq
```

---

## ğŸ“± ç§»åŠ¨ç«¯/æ¡Œé¢ç«¯æ˜¾ç¤ºå»ºè®®

### åˆ—è¡¨è§†å›¾ï¼ˆç®€æ´ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è®°å¿†å†…å®¹...                      â”‚
â”‚ ğŸŸ¢ 85% | è®¿é—®: 10æ¬¡ | 2å¤©å‰     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è¯¦æƒ…è§†å›¾ï¼ˆå®Œæ•´ï¼‰

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è®°å¿†è¯¦æƒ…                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ è¡°é€€åˆ†æ•°                         â”‚
â”‚ â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘ 85%        â”‚
â”‚                                  â”‚
â”‚ é‡è¦æ€§: â­â­â­â­â­ (100%)        â”‚
â”‚ è®¿é—®æ¬¡æ•°: 10æ¬¡                   â”‚
â”‚ æœ€åè®¿é—®: 2å¤©å‰                  â”‚
â”‚ åˆ›å»ºæ—¶é—´: 30å¤©å‰                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âœ… æ€»ç»“

### æŸ¥çœ‹è¡°é€€åˆ†æ•°çš„æ–¹å¼

1. **æ•°æ®åº“ç›´æ¥æŸ¥è¯¢**
   - SQLite å‘½ä»¤è¡Œ
   - MySQL å®¢æˆ·ç«¯
   - æ•°æ®åº“ç®¡ç†å·¥å…·

2. **API æ¥å£**
   - å•ä¸ªè®°å¿†è¯¦æƒ…
   - è®°å¿†åˆ—è¡¨
   - è¡°é€€ç»Ÿè®¡
   - è¡°é€€è®°å¿†åˆ—è¡¨

3. **Web ç•Œé¢**ï¼ˆéœ€è¦å‰ç«¯ä¿®æ”¹ï¼‰
   - è®°å¿†åˆ—è¡¨æ˜¾ç¤º
   - è¯¦æƒ…é¡µé¢æ˜¾ç¤º
   - ç»Ÿè®¡ä»ªè¡¨æ¿

### è¡°é€€åˆ†æ•°å­—æ®µ

- `decay_score`: è¡°é€€åˆ†æ•° (0.0-1.0)
- `importance_score`: é‡è¦æ€§åˆ†æ•° (0.0-1.0)
- `access_count`: è®¿é—®æ¬¡æ•°
- `last_accessed_at`: æœ€åè®¿é—®æ—¶é—´

### å¿«é€Ÿå‘½ä»¤

```bash
# æŸ¥çœ‹æ•°æ®åº“ä¸­çš„è¡°é€€åˆ†æ•°
docker compose exec openmemory-api sqlite3 openmemory.db \
  "SELECT id, decay_score, content FROM memories LIMIT 10;"

# é€šè¿‡APIæŸ¥çœ‹ç»Ÿè®¡
curl "http://localhost:8765/api/v1/decay/statistics?user_id=user123"

# æŸ¥çœ‹è¡°é€€è®°å¿†
curl "http://localhost:8765/api/v1/decay/decayed-memories?user_id=user123&threshold=0.3"
```

**è¡°é€€åˆ†æ•°å·²ç»å­˜å‚¨åœ¨æ•°æ®åº“ä¸­ï¼Œå¯ä»¥é€šè¿‡å¤šç§æ–¹å¼æŸ¥çœ‹ï¼** ğŸ“Š