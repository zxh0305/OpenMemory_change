# OpenMemory é…ç½®ä¼˜åŒ–å»ºè®® ğŸš€

> æ ¹æ®ä¸åŒä½¿ç”¨åœºæ™¯ä¼˜åŒ– OpenMemory çš„æ€§èƒ½å’Œèµ„æºå ç”¨

## ğŸ“Š ä½¿ç”¨åœºæ™¯åˆ†ç±»

### 1ï¸âƒ£ ä¸ªäººä½¿ç”¨ (< 10,000 æ¡è®°å¿†)

**æ¨èé…ç½®**: æœ€å°åŒ–èµ„æºå ç”¨

#### api/.env
```env
# åŸºç¡€é…ç½®
OPENAI_API_KEY=sk-xxx
USER=my_user

# ä½¿ç”¨è½»é‡çº§æ¨¡å‹
OPENAI_MODEL=gpt-4o-mini
CATEGORIZATION_OPENAI_MODEL=gpt-4o-mini

# ä½¿ç”¨è¾ƒå°çš„åµŒå…¥ç»´åº¦
OPENAI_EMBEDDING_MODEL=text-embedding-3-small
OPENAI_EMBEDDING_MODEL_DIMS=512  # é™ä½åˆ° 512 ç»´

# ä½¿ç”¨ SQLite (é»˜è®¤)
DATABASE_URL=sqlite:///./openmemory.db
```

**èµ„æºéœ€æ±‚**:
- å†…å­˜: 1.5-2 GB
- ç£ç›˜: 1-2 GB
- CPU: 2 æ ¸å¿ƒ

**ä¼˜åŠ¿**:
- âœ… å¯åŠ¨å¿«é€Ÿ
- âœ… èµ„æºå ç”¨å°‘
- âœ… é…ç½®ç®€å•

---

### 2ï¸âƒ£ å›¢é˜Ÿä½¿ç”¨ (10,000 - 100,000 æ¡è®°å¿†)

**æ¨èé…ç½®**: å¹³è¡¡æ€§èƒ½å’Œèµ„æº

#### api/.env
```env
# åŸºç¡€é…ç½®
OPENAI_API_KEY=sk-xxx

# ä½¿ç”¨æ ‡å‡†æ¨¡å‹
OPENAI_MODEL=gpt-4o-mini
OPENAI_EMBEDDING_MODEL=text-embedding-3-small
OPENAI_EMBEDDING_MODEL_DIMS=1536  # æ ‡å‡†ç»´åº¦

# ä½¿ç”¨ PostgreSQL
DATABASE_URL=postgresql://openmemory:password@localhost:5432/openmemory
```

#### docker-compose.yml æ·»åŠ  PostgreSQL
```yaml
services:
  postgres:
    image: postgres:15
    container_name: openmemory-postgres
    environment:
      POSTGRES_DB: openmemory
      POSTGRES_USER: openmemory
      POSTGRES_PASSWORD: password
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data

  openmemory-api:
    depends_on:
      - postgres
      - mem0_store
    # ... å…¶ä»–é…ç½®

volumes:
  postgres_data:
```

**èµ„æºéœ€æ±‚**:
- å†…å­˜: 4-6 GB
- ç£ç›˜: 10-20 GB
- CPU: 4 æ ¸å¿ƒ

**ä¼˜åŠ¿**:
- âœ… æ›´å¥½çš„å¹¶å‘æ€§èƒ½
- âœ… æ”¯æŒæ›´å¤šç”¨æˆ·
- âœ… æ•°æ®æ›´å®‰å…¨

---

### 3ï¸âƒ£ ä¼ä¸šä½¿ç”¨ (> 100,000 æ¡è®°å¿†)

**æ¨èé…ç½®**: æœ€å¤§åŒ–æ€§èƒ½

#### api/.env
```env
# åŸºç¡€é…ç½®
OPENAI_API_KEY=sk-xxx

# ä½¿ç”¨é«˜æ€§èƒ½æ¨¡å‹
OPENAI_MODEL=gpt-4o
OPENAI_EMBEDDING_MODEL=text-embedding-3-large
OPENAI_EMBEDDING_MODEL_DIMS=3072  # æœ€å¤§ç»´åº¦

# ä½¿ç”¨ PostgreSQL é›†ç¾¤
DATABASE_URL=postgresql://openmemory:password@postgres-primary:5432/openmemory
```

#### docker-compose.yml èµ„æºé™åˆ¶
```yaml
services:
  mem0_store:
    deploy:
      resources:
        limits:
          memory: 8G
          cpus: '4'
        reservations:
          memory: 4G
          cpus: '2'

  openmemory-api:
    command: uvicorn main:app --host 0.0.0.0 --port 8765 --workers 8
    deploy:
      resources:
        limits:
          memory: 4G
          cpus: '4'
        reservations:
          memory: 2G
          cpus: '2'
```

**èµ„æºéœ€æ±‚**:
- å†…å­˜: 16+ GB
- ç£ç›˜: 100+ GB SSD
- CPU: 8+ æ ¸å¿ƒ

**ä¼˜åŠ¿**:
- âœ… æœ€ä½³æ€§èƒ½
- âœ… æ”¯æŒå¤§è§„æ¨¡æ•°æ®
- âœ… é«˜å¯ç”¨æ€§

---

## ğŸŒ å›½å†… API æœåŠ¡é…ç½®

### ç¡…åŸºæµåŠ¨ (SiliconFlow)

```env
# é«˜æ€§ä»·æ¯”é…ç½®
OPENAI_API_KEY=sk-your-siliconflow-key
OPENAI_PROVIDER=openai_structured
OPENAI_BASE_URL=https://api.siliconflow.cn/v1
OPENAI_MODEL=deepseek-ai/DeepSeek-R1-0528-Qwen3-8B

# åµŒå…¥æ¨¡å‹
OPENAI_EMBEDDING_MODEL_API_KEY=sk-your-siliconflow-key
OPENAI_EMBEDDING_MODEL_BASE_URL=https://api.siliconflow.cn/v1
OPENAI_EMBEDDING_MODEL=Qwen/Qwen3-Embedding-4B
OPENAI_EMBEDDING_MODEL_DIMS=1024

# åˆ†ç±»åŠŸèƒ½
CATEGORIZATION_OPENAI_API_KEY=sk-your-siliconflow-key
CATEGORIZATION_OPENAI_BASE_URL=https://api.siliconflow.cn/v1
CATEGORIZATION_OPENAI_MODEL=deepseek-ai/DeepSeek-R1-0528-Qwen3-8B
```

**ä¼˜åŠ¿**:
- ğŸ’° ä»·æ ¼ä¾¿å®œ (çº¦ä¸º OpenAI çš„ 1/10)
- ğŸš€ å›½å†…è®¿é—®å¿«
- ğŸ‡¨ğŸ‡³ æ”¯æŒä¸­æ–‡ä¼˜åŒ–

### DeepSeek

```env
OPENAI_API_KEY=sk-your-deepseek-key
OPENAI_BASE_URL=https://api.deepseek.com/v1
OPENAI_MODEL=deepseek-chat

OPENAI_EMBEDDING_MODEL_API_KEY=sk-your-deepseek-key
OPENAI_EMBEDDING_MODEL_BASE_URL=https://api.deepseek.com/v1
OPENAI_EMBEDDING_MODEL=deepseek-embedding
```

### æ™ºè°± AI (GLM)

```env
OPENAI_API_KEY=your-zhipu-key
OPENAI_BASE_URL=https://open.bigmodel.cn/api/paas/v4
OPENAI_MODEL=glm-4-flash

OPENAI_EMBEDDING_MODEL_API_KEY=your-zhipu-key
OPENAI_EMBEDDING_MODEL_BASE_URL=https://open.bigmodel.cn/api/paas/v4
OPENAI_EMBEDDING_MODEL=embedding-2
```

---

## âš¡ æ€§èƒ½ä¼˜åŒ–æŠ€å·§

### 1. å‡å°‘å‘é‡ç»´åº¦

**æ•ˆæœ**: å†…å­˜å ç”¨å‡å°‘ 66%ï¼Œæœç´¢é€Ÿåº¦æå‡ 50%

```env
# ä» 1536 é™åˆ° 512
OPENAI_EMBEDDING_MODEL_DIMS=512
```

**é€‚ç”¨åœºæ™¯**: ä¸ªäººä½¿ç”¨ï¼Œå¯¹æœç´¢ç²¾åº¦è¦æ±‚ä¸é«˜

### 2. ç¦ç”¨è‡ªåŠ¨åˆ†ç±»

**æ•ˆæœ**: å‡å°‘ API è°ƒç”¨ï¼ŒåŠ å¿«è®°å¿†ä¿å­˜é€Ÿåº¦

ä¿®æ”¹ `api/app/models.py`:
```python
# æ³¨é‡Šæ‰è¿™ä¸¤ä¸ªäº‹ä»¶ç›‘å¬å™¨
# @event.listens_for(Memory, "after_insert")
# def after_memory_insert(mapper, connection, target):
#     ...

# @event.listens_for(Memory, "after_update")
# def after_memory_update(mapper, connection, target):
#     ...
```

**é€‚ç”¨åœºæ™¯**: ä¸éœ€è¦è‡ªåŠ¨åˆ†ç±»åŠŸèƒ½

### 3. è°ƒæ•´å·¥ä½œè¿›ç¨‹æ•°

```yaml
# docker-compose.yml
command: uvicorn main:app --workers 4
# æ¨è: workers = CPU æ ¸å¿ƒæ•° Ã— 2
```

### 4. ä½¿ç”¨ Redis ç¼“å­˜

æ·»åŠ  Redis æœåŠ¡:
```yaml
services:
  redis:
    image: redis:7-alpine
    container_name: openmemory-redis
    ports:
      - "6379:6379"
```

### 5. å¯ç”¨ Gzip å‹ç¼©

åœ¨ `api/main.py` ä¸­æ·»åŠ :
```python
from fastapi.middleware.gzip import GZipMiddleware

app.add_middleware(GZipMiddleware, minimum_size=1000)
```

---

## ğŸ’¾ å­˜å‚¨ä¼˜åŒ–

### 1. å®šæœŸæ¸…ç†å·²åˆ é™¤è®°å¿†

```sql
-- æ°¸ä¹…åˆ é™¤æ ‡è®°ä¸º deleted çš„è®°å¿†
DELETE FROM memories WHERE state = 'deleted' AND deleted_at < NOW() - INTERVAL '30 days';
```

### 2. å½’æ¡£æ—§è®°å¿†

```sql
-- å°† 6 ä¸ªæœˆå‰çš„è®°å¿†å½’æ¡£
UPDATE memories 
SET state = 'archived', archived_at = NOW()
WHERE created_at < NOW() - INTERVAL '6 months' 
AND state = 'active';
```

### 3. å‹ç¼© Qdrant æ•°æ®

```bash
# è¿›å…¥ Qdrant å®¹å™¨
docker exec -it openmemory-qdrant sh

# ä¼˜åŒ–é›†åˆ
curl -X POST 'http://localhost:6333/collections/openmemory/optimize'
```

---

## ğŸ”’ å®‰å…¨ä¼˜åŒ–

### 1. ä½¿ç”¨ç¯å¢ƒå˜é‡

**ä¸è¦åœ¨ .env æ–‡ä»¶ä¸­å­˜å‚¨ç”Ÿäº§å¯†é’¥**

```bash
# ä½¿ç”¨ç³»ç»Ÿç¯å¢ƒå˜é‡
export OPENAI_API_KEY=sk-xxx
export DATABASE_URL=postgresql://...

# æˆ–ä½¿ç”¨ Docker secrets
docker secret create openai_key openai_key.txt
```

### 2. é™åˆ¶ API è®¿é—®

ä½¿ç”¨ Nginx åå‘ä»£ç†:
```nginx
server {
    listen 80;
    server_name your-domain.com;

    # é™åˆ¶è¯·æ±‚é€Ÿç‡
    limit_req_zone $binary_remote_addr zone=api:10m rate=10r/s;

    location /api {
        limit_req zone=api burst=20;
        proxy_pass http://localhost:8765;
    }
}
```

### 3. å¯ç”¨ HTTPS

```bash
# ä½¿ç”¨ Certbot
sudo certbot --nginx -d your-domain.com
```

---

## ğŸ“Š ç›‘æ§å»ºè®®

### 1. èµ„æºç›‘æ§

```bash
# å®æ—¶ç›‘æ§
docker stats

# æŸ¥çœ‹ç£ç›˜ä½¿ç”¨
du -sh mem0_storage/
du -sh api/openmemory.db
```

### 2. æ—¥å¿—ç®¡ç†

```yaml
# docker-compose.yml
services:
  openmemory-api:
    logging:
      driver: "json-file"
      options:
        max-size: "10m"
        max-file: "3"
```

### 3. å¥åº·æ£€æŸ¥

```yaml
healthcheck:
  test: ["CMD", "curl", "-f", "http://localhost:8765/health"]
  interval: 30s
  timeout: 10s
  retries: 3
```

---

## ğŸ¯ æ¨èé…ç½®ç»„åˆ

### æœ€å°é…ç½® (ä¸ªäºº)
```env
OPENAI_API_KEY=sk-xxx
OPENAI_MODEL=gpt-4o-mini
OPENAI_EMBEDDING_MODEL_DIMS=512
DATABASE_URL=sqlite:///./openmemory.db
```

### å¹³è¡¡é…ç½® (å›¢é˜Ÿ)
```env
OPENAI_API_KEY=sk-xxx
OPENAI_MODEL=gpt-4o-mini
OPENAI_EMBEDDING_MODEL_DIMS=1536
DATABASE_URL=postgresql://user:pass@localhost:5432/openmemory
```

### é«˜æ€§èƒ½é…ç½® (ä¼ä¸š)
```env
OPENAI_API_KEY=sk-xxx
OPENAI_MODEL=gpt-4o
OPENAI_EMBEDDING_MODEL=text-embedding-3-large
OPENAI_EMBEDDING_MODEL_DIMS=3072
DATABASE_URL=postgresql://user:pass@postgres-cluster:5432/openmemory
```

### å›½å†…ä¼˜åŒ–é…ç½®
```env
OPENAI_API_KEY=sk-siliconflow-key
OPENAI_PROVIDER=openai_structured
OPENAI_BASE_URL=https://api.siliconflow.cn/v1
OPENAI_MODEL=deepseek-ai/DeepSeek-R1
OPENAI_EMBEDDING_MODEL=Qwen/Qwen3-Embedding-4B
OPENAI_EMBEDDING_MODEL_DIMS=1024
```

---

## ğŸ“ˆ æ€§èƒ½å¯¹æ¯”

| é…ç½® | å†…å­˜ | å“åº”æ—¶é—´ | æˆæœ¬/æœˆ | é€‚ç”¨åœºæ™¯ |
|------|------|----------|---------|----------|
| æœ€å° | 2GB | ~500ms | $5-10 | ä¸ªäºº |
| å¹³è¡¡ | 4GB | ~300ms | $20-50 | å›¢é˜Ÿ |
| é«˜æ€§èƒ½ | 16GB | ~100ms | $100+ | ä¼ä¸š |
| å›½å†… | 2-4GB | ~200ms | $2-5 | å›½å†…ç”¨æˆ· |

---

## âœ… ä¼˜åŒ–æ£€æŸ¥æ¸…å•

- [ ] é€‰æ‹©åˆé€‚çš„ LLM æ¨¡å‹
- [ ] è°ƒæ•´åµŒå…¥å‘é‡ç»´åº¦
- [ ] é…ç½®åˆé€‚çš„æ•°æ®åº“
- [ ] è®¾ç½®èµ„æºé™åˆ¶
- [ ] å¯ç”¨æ—¥å¿—ç®¡ç†
- [ ] é…ç½®å¥åº·æ£€æŸ¥
- [ ] è®¾ç½®å¤‡ä»½ç­–ç•¥
- [ ] å¯ç”¨ HTTPS (ç”Ÿäº§ç¯å¢ƒ)
- [ ] é…ç½®ç›‘æ§å‘Šè­¦
- [ ] å®šæœŸæ¸…ç†æ•°æ®

---

**éœ€è¦å¸®åŠ©?** æŸ¥çœ‹ [è¯¦ç»†ä½¿ç”¨æŒ‡å—](README_è¯¦ç»†ä½¿ç”¨æŒ‡å—.md) æˆ– [å¿«é€Ÿå¼€å§‹](å¿«é€Ÿå¼€å§‹.md)